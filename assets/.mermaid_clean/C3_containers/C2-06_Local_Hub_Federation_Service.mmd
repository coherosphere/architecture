flowchart LR
  %% --- Coherosphere CI Theme ---
  classDef container fill:#111827,stroke:#111827,color:#ffffff,font-weight:bold;
  classDef compute fill:#ff8b00,stroke:#333333,color:#ffffff;
  classDef control fill:#fde68a,stroke:#b45309,color:#1f2937;
  classDef worker fill:#fb923c,stroke:#7c2d12,color:#1f2937;
  classDef store fill:#0ea5e9,stroke:#075985,color:#ffffff;
  classDef event fill:#22c55e,stroke:#065f46,color:#083344;
  classDef risk fill:#ef4444,stroke:#7f1d1d,color:#ffffff;
  classDef ext fill:#e5e7eb,stroke:#9ca3af,color:#111827;
  classDef ui fill:#8b5cf6,stroke:#4c1d95,color:#ffffff;
  linkStyle default stroke:#334155,stroke-width:2px;

  %% ===== Container & Components (C2-06 â†’ C3-06.xx) =====
  subgraph HUB["C2-06 Local Hub / Federation Service"]
    class HUB container
    SYNC["C3-06.01 Sync Orchestrator"]:::control
    CRDT["C3-06.02 CRDT Resolver"]:::compute
    PROJ["C3-06.03 Project Registry"]:::store
    FED["C3-06.04 Federation Client (Bus/Signals)"]:::event
    HEALTH["C3-06.05 Health & Telemetry Monitor"]:::worker
    EDGE["C3-06.06 Edge Store (Local State)"]:::store
  end

  %% ===== Internal flows =====
  PROJ --> SYNC --> CRDT --> FED
  SYNC --> EDGE
  CRDT --> EDGE
  HEALTH --> FED

  %% ===== External context links =====
  ORG["C1-05 Local Communities / Institutions"]:::ext --> PROJ
  GOV["C2-03 Governance Service"]:::ext --> PROJ
  TRE["C2-04 Treasury & Funding"]:::ext --> PROJ
  FED --> MET["C2-07 Metrics / Analytics"]:::ext
  PROJ --> KNOW["C2-09 Knowledge Graph"]:::ext
  EDGE --> SEC["C2-10 Security & Audit"]:::ext
  UI["C2-12 Resonance Board / UI"]:::ui --> PROJ
