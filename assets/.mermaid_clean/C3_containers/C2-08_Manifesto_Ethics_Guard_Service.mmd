flowchart LR
  %% --- Coherosphere CI Theme ---
  classDef container fill:#111827,stroke:#111827,color:#ffffff,font-weight:bold;
  classDef compute fill:#ff8b00,stroke:#333333,color:#ffffff;
  classDef control fill:#fde68a,stroke:#b45309,color:#1f2937;
  classDef worker fill:#fb923c,stroke:#7c2d12,color:#1f2937;
  classDef store fill:#0ea5e9,stroke:#075985,color:#ffffff;
  classDef event fill:#22c55e,stroke:#065f46,color:#083344;
  classDef risk fill:#ef4444,stroke:#7f1d1d,color:#ffffff;
  classDef ext fill:#e5e7eb,stroke:#9ca3af,color:#111827;
  classDef ui fill:#8b5cf6,stroke:#4c1d95,color:#ffffff;
  linkStyle default stroke:#334155,stroke-width:2px;

  %% ===== Container & Components (C2-08 â†’ C3-08.xx) =====
  subgraph ETH["C2-08 Manifesto & Ethics Guard"]
    class ETH container
    RUB["C3-08.02 Rubric Manager (versioning)"]:::control
    ALIGN["C3-08.01 Alignment Evaluator"]:::compute
    POL["C3-08.03 Ethics Policy Engine (allow/deny)"]:::control
    ATT["C3-08.04 Attestation Issuer"]:::event
    APL["C3-08.05 Appeals Handler / Re-evaluation"]:::worker
    EDB["C3-08.06 Ethics Data Store"]:::store
    GFEED["C3-08.07 Governance Guidance Feed"]:::event
  end

  %% ===== Internal flows =====
  RUB --> ALIGN --> POL
  POL --> ATT
  ALIGN --> EDB
  POL --> EDB
  ATT --> EDB
  APL --> ALIGN
  GFEED --> EDB

  %% ===== External context links =====
  POC["C2-02 PoC Service"]:::ext --> POL
  GOV["C2-03 Governance Service"]:::ext --> POL
  KNOW["C2-09 Knowledge Graph"]:::ext --> ALIGN
  ATT --> ID["C2-05 Identity (PoCI)"]:::ext
  ATT --> MET["C2-07 Metrics / Analytics"]:::ext
  ATT --> UI["C2-12 Resonance Board / UI"]:::ui
  SEC["C2-10 Security & Audit"]:::ext --> POL
  GFEED -. guidance .-> GOV
