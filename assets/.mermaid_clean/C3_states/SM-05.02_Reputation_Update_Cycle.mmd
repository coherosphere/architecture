%%{init: {'theme':'base','themeVariables':{ 'primaryColor':'#ff8b00','edgeLabelBackground':'#ffffff','tertiaryColor':'#fef3c7'}}}%%

stateDiagram-v2
title: SM-05.02 — Reputation Update Cycle (C2-05 Identity & Reputation / PoCI)

[*] --> BASELINE : ReputationInitialized
note right of BASELINE
  Initialize reputation score (R₀)
  • baseline = 1.0 or derived from initial attestations  
  • linked to DID and contributor identity
end note

BASELINE --> ACCUMULATING : AttestationIssued (DDD EVT 53)
note right of ACCUMULATING
  Add positive or negative deltas (ΔR)
  Based on validated PoC, Ethics, Treasury actions  
  Weighted by source trust and recency
end note

ACCUMULATING --> DECAYING : TimeElapsed / DecayTrigger
note right of DECAYING
  Apply exponential decay to reputation:  
  Rₜ = R₀ × e^(−λ·Δt)  
  λ defined in MetaGov parameters
end note

DECAYING --> UPDATED : ReputationUpdated (DDD EVT 55)
note right of UPDATED
  Persist updated R value to PoCI ledger  
  Emit metrics to C2-07 (Resonance Metric Stack)
end note

UPDATED --> ACCUMULATING : NewAttestation
UPDATED --> DECAYING : PeriodicDecayTick
UPDATED --> [*] : SnapshotArchived

%% ---- Exceptional paths ----
ACCUMULATING --> FLAGGED : FraudDetected / SybilPattern
FLAGGED --> REVIEW : UnderReview
REVIEW --> ACCUMULATING : Cleared
REVIEW --> SANCTIONED : ViolationConfirmed
SANCTIONED --> [*] : ReputationRevoked (DDD EVT 56)

%% ===== Styling =====
classDef core fill:#ff8b00,stroke:#333,color:#fff,font-weight:bold;
class BASELINE,ACCUMULATING,DECAYING,UPDATED,FLAGGED,REVIEW,SANCTIONED core;