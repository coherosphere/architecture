%%{init: {'theme':'base','themeVariables':{ 'primaryColor':'#ff8b00','edgeLabelBackground':'#ffffff','tertiaryColor':'#fef3c7'}}}%%
stateDiagram-v2
title: SM-10.02 — Transparency Report Lifecycle (C2-10 Security & Audit)

[*] --> DRAFT : ReportInitiated
note right of DRAFT
  Create report shell:
  • incident/ref IDs bound
  • scope, timeline, owners
  • initial checklist opened
end note

DRAFT --> DATA_GATHER : EvidenceRequested
note right of DATA_GATHER
  Collect evidence:
  • SIEM logs, ledger snapshots
  • config diffs, patches
  • governance directives
end note

DATA_GATHER --> AUTHORING : EvidenceCollected
note right of AUTHORING
  Compile narrative:
  • root cause, impact, fixes
  • timelines & tables
  • redactions planned
end note

AUTHORING --> LEGAL_REVIEW : DraftReady
LEGAL_REVIEW --> ETHICS_REVIEW : LegalCleared
ETHICS_REVIEW --> QA_REVIEW : EthicsCleared
QA_REVIEW --> SIGNING : QAApproved

%% Signing & generation
SIGNING --> GENERATED : ReportGenerated (DDD EVT 94)
note right of GENERATED
  Immutable bundle produced:
  • hashes, signatures, timestamp
  • public & internal versions
end note

GENERATED --> PUBLISHING : PublishRequested
PUBLISHING --> PUBLISHED : TransparencyReportPublished (DDD EVT 92)
PUBLISHED --> ARCHIVED : ArchiveScheduled
ARCHIVED --> [*]

%% Corrections / amendments
PUBLISHED --> AMEND_REQ : CorrectionRequested
AMEND_REQ --> AUTHORING : AmendmentAuthorized

%% Exceptions / failure paths
DATA_GATHER --> FAILED : MissingEvidence / HashMismatch
AUTHORING --> FAILED : IncompleteNarrative
LEGAL_REVIEW --> FAILED : LegalBlock
ETHICS_REVIEW --> FAILED : EthicsBlock
QA_REVIEW --> FAILED : QAFailed
SIGNING --> FAILED : SignatureError
PUBLISHING --> FAILED : PublishError
FAILED --> [*] : ReportAbandoned

%% ===== Styling =====
classDef core fill:#ff8b00,stroke:#333,color:#fff,font-weight:bold;
class DRAFT,DATA_GATHER,AUTHORING,LEGAL_REVIEW,ETHICS_REVIEW,QA_REVIEW,SIGNING,GENERATED,PUBLISHING,PUBLISHED,ARCHIVED,AMEND_REQ,FAILED core;
