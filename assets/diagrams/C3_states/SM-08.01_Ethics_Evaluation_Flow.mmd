%%{init: {'theme':'base','themeVariables':{ 'primaryColor':'#ff8b00','edgeLabelBackground':'#ffffff','tertiaryColor':'#fef3c7'}}}%%
stateDiagram-v2
title: SM-08.01 — Ethics Evaluation Flow (C2-08 Manifesto & Ethics Guard)

[*] --> PENDING : AlignmentChecked (DDD EVT 80)
note right of PENDING
  Ethics evaluation initiated  
  • triggered by new PoC or Proposal event  
  • fetch rubric and Manifesto version  
  • assign evaluator (human or AI)
end note

PENDING --> EVALUATING : EvaluationStarted
note right of EVALUATING
  Process input through multi-layer rubric:  
  • quantitative: resonance, alignment  
  • qualitative: intent, externalities  
  • hybrid AI-human scoring possible
end note

EVALUATING --> UNDER_REVIEW : ScoreComputed / RequiresHumanReview
note right of UNDER_REVIEW
  If confidence < threshold, escalate  
  • peer review or ethics board confirmation  
  • discussion / comments appended  
end note

EVALUATING --> APPROVED : EthicsPassed (DDD EVT 81)
EVALUATING --> REJECTED : EthicsFailed (DDD EVT 82)

UNDER_REVIEW --> APPROVED : Confirmed / ConsensusReached
UNDER_REVIEW --> REJECTED : EthicsViolationConfirmed

APPROVED --> ATTESTATION : AttestationIssued (DDD EVT 83)
note right of ATTESTATION
  Issue ethics attestation (VC / SBT)  
  • stored in PoCI (C2-05)  
  • feeds resonance scoring (C2-01)  
  • updates metrics (C2-07)
end note

ATTESTATION --> [*] : EvaluationClosed

REJECTED --> FLAGGED : FlaggedForViolation
FLAGGED --> GOV_NOTIFY : GovernanceAlertRaised (DDD EVT 84)
GOV_NOTIFY --> [*] : EthicsCaseLogged

%% ---- Exceptional paths ----
PENDING --> FAILED : InvalidInput / RubricMissing
EVALUATING --> FAILED : ModelError / Timeout
FAILED --> [*] : EvaluationAborted

%% ===== Styling =====
classDef core fill:#ff8b00,stroke:#333,color:#fff,font-weight:bold;
class PENDING,EVALUATING,UNDER_REVIEW,APPROVED,REJECTED,ATTESTATION,FLAGGED,GOV_NOTIFY,FAILED core;