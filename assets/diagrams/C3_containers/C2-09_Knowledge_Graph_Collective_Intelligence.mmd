%%{init: {'theme':'base','themeVariables':{ 'fontFamily':'Inter,Arial', 'primaryColor':'#ff8b00','lineColor':'#334155'}}}%%
flowchart LR
%%{init: {'theme':'base','themeVariables':{ 'fontFamily':'Inter,Arial', 'primaryColor':'#ff8b00','lineColor':'#334155'}}}%%
flowchart LR
  %% --- Coherosphere CI Theme ---
  classDef container fill:#111827,stroke:#111827,color:#ffffff,font-weight:bold;
  classDef compute fill:#ff8b00,stroke:#333333,color:#ffffff;
  classDef control fill:#fde68a,stroke:#b45309,color:#1f2937;
  classDef worker fill:#fb923c,stroke:#7c2d12,color:#1f2937;
  classDef store fill:#0ea5e9,stroke:#075985,color:#ffffff;
  classDef event fill:#22c55e,stroke:#065f46,color:#083344;
  classDef risk fill:#ef4444,stroke:#7f1d1d,color:#ffffff;
  classDef ext fill:#e5e7eb,stroke:#9ca3af,color:#111827;
  classDef ui fill:#8b5cf6,stroke:#4c1d95,color:#ffffff;
  linkStyle default stroke:#334155,stroke-width:2px;

  %% ===== Container & Components (C2-09 â†’ C3-09.xx) =====
  subgraph KG["C2-09 Knowledge Graph / Collective Intelligence"]
    class KG container
    ONT["C3-09.01 Ontology Manager"]:::control
    ING["C3-09.02 Graph Ingest Pipeline"]:::worker
    EMB["C3-09.03 Embedding Generator"]:::compute
    RAG["C3-09.04 RAG Orchestrator"]:::control
    SYN["C3-09.05 Synthesis Engine"]:::compute
    KGDB["C3-09.06 KG-Store (Graph DB)"]:::store
    VDB["C3-09.07 Vector-DB"]:::store
    PUB["C3-09.08 Knowledge Event Publisher"]:::event
  end

  %% ===== Internal flows =====
  ONT --> ING
  ING --> KGDB
  ING --> EMB
  EMB --> VDB
  RAG --> SYN
  SYN --> KGDB
  SYN --> PUB

  %% ===== External context links =====
  HUB["C2-06 Local Hubs / Projects"]:::ext --> ING
  POC["C2-02 PoC Service"]:::ext --> ING
  RS["C2-01 Resonance Service"]:::ext --> ING
  MET["C2-07 Metrics / Analytics"]:::ext --> SYN
  ETH["C2-08 Manifesto & Ethics Guard"]:::ext --> RAG
  UI["C2-12 Resonance Board / UI"]:::ui <-- RAG
  PUB --> MET
  PUB --> UI
