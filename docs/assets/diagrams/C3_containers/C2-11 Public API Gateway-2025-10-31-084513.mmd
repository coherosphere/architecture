flowchart LR
  %% --- Coherosphere CI Theme ---
  classDef container fill:#111827,stroke:#111827,color:#ffffff,font-weight:bold;
  classDef compute fill:#ff8b00,stroke:#333333,color:#ffffff;
  classDef control fill:#fde68a,stroke:#b45309,color:#1f2937;
  classDef worker fill:#fb923c,stroke:#7c2d12,color:#1f2937;
  classDef store fill:#0ea5e9,stroke:#075985,color:#ffffff;
  classDef event fill:#22c55e,stroke:#065f46,color:#083344;
  classDef risk fill:#ef4444,stroke:#7f1d1d,color:#ffffff;
  classDef ext fill:#e5e7eb,stroke:#9ca3af,color:#111827;
  classDef ui fill:#8b5cf6,stroke:#4c1d95,color:#ffffff;
  linkStyle default stroke:#334155,stroke-width:2px;

  %% ===== Container & Components (C2-11 â†’ C3-11.xx) =====
  subgraph API["C2-11 Public API Gateway"]
    class API container
    ROUTE["C3-11.01 Smart Router (REST/gRPC)"]:::control
    GQL["C3-11.02 GraphQL Federation"]:::compute
    AUTH["C3-11.03 Auth Hub (Tokens, Sessions)"]:::control
    RATE["C3-11.04 Rate & Quota Manager"]:::control
    SGUARD["C3-11.05 Schema Guard & Policy Validator"]:::control
    TEL["C3-11.06 Telemetry Collector"]:::worker
    DEVPORT["C3-11.07 Developer Portal (Docs, Keys)"]:::ui
    APILOG["C3-11.08 API Log Store"]:::store
    PUB["C3-11.09 Event Publisher (API Metrics)"]:::event
  end

  %% ===== Internal flows =====
  ROUTE --> GQL
  ROUTE --> SGUARD --> RATE
  ROUTE --> AUTH
  ROUTE --> TEL
  TEL --> APILOG
  TEL --> PUB
  DEVPORT --> ROUTE

  %% ===== External context links =====
  UI["C2-12 Resonance Board / UI"]:::ui --> ROUTE
  DEV["C1-07 Developers / Architects"]:::ext --> DEVPORT
  SEC["C2-10 Security & Audit"]:::ext --> TEL
  PUB --> MET["C2-07 Metrics / Analytics"]:::ext
  ROUTE --> RS["C2-01 Resonance"]:::ext
  ROUTE --> POC["C2-02 PoC Service"]:::ext
  ROUTE --> GOV["C2-03 Governance"]:::ext
  ROUTE --> TRE["C2-04 Treasury"]:::ext
  ROUTE --> ID["C2-05 Identity (PoCI)"]:::ext
  ROUTE --> HUB["C2-06 Local Hubs"]:::ext
  ROUTE --> ETH["C2-08 Ethics Guard"]:::ext
  ROUTE --> KNOW["C2-09 Knowledge Graph"]:::ext